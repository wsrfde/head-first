<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <!-- onload="loadResources()" -->

  <img id="image0" src="https://api.pixiv.moe/image/i.pximg.net/img-original/img/2021/03/30/14/51/02/87125909_p0.png">
  <img id="image1" src="https://api.pixiv.moe/image/i.pximg.net/img-original/img/2020/11/30/00/02/57/85995323_p0.jpg">
  <img src="" alt="">
  <img src="https://api.pixiv" alt="">
  <script>
    // let arr = document.querySelectorAll('img')
    // let availableImgArr = Array(...arr).filter(n => n.getAttribute('src') !== '')
    // availableImgArr.forEach((item, index) => {
    //   item.onload = test
    // })
    // console.log('æ‰€æœ‰å›¾ç‰‡æ€»æ•°é‡ä¸º', availableImgArr.length)
    // let arr = document.querySelectorAll('img')
    // arr.forEach(item => {
    //   item.onload = function () {
    //     console.count('------');
    //   }
    //   item.onerror = function () {
    //     console.error('is error')
    //   }
    // })


    // function loadResources() {
    //   var image1 = new Image();
    //   image1.onload = resourceTiming;
    //   image1.src = 'https://api.pixiv.moe/image/i.pximg.net/img-original/img/2021/03/30/14/51/02/87125909_p0.png';
    // }
    // window.onload = function (params) {
    //   resourceTiming()
    // }
    // let arr = document.querySelectorAll('img')
    // let availableImgArr = Array(...arr).filter(n => n.getAttribute('src') !== '')
    // console.log('æ‰€æœ‰å›¾ç‰‡æ€»æ•°é‡ä¸º', availableImgArr.length)
    //
    let arr = document.querySelectorAll('img')
    let availableImgArr = Array(...arr).filter(n => n.getAttribute('src') !== '')
    console.log('æ‰€æœ‰å›¾ç‰‡æ€»æ•°é‡ä¸º', availableImgArr.length)

    window.onload = function () {
      console.log('--------')
      // resourceTiming()
    }

    function resourceTiming() {
      let resourceList = window.performance.getEntriesByType("resource");
      let imgResourceList = resourceList.filter(item => item.initiatorType === 'img').length
      console.log(resourceList);
      console.log('å›¾ç‰‡æ€»æ•°é‡ä¸ºï¼š' + imgResourceList)
      let successCount = 0
      for (let item of resourceList) {
        if (item.initiatorType === "img" && item.nextHopProtocol !== '') {
          successCount++;
          console.log("è¯·æ±‚æˆåŠŸï¼Œæ—¶é—´ä¸º: " + (item.responseEnd) + 'ã€‚è®¡æ•°ä¸ºï¼š' + successCount);
        }
        if(item.initiatorType === "img" && item.nextHopProtocol === ''){
          console.log('åè®®ä¸ºç©ºçš„itemï¼š',item)
        }
      }
      // if(successCount < nonEmptyImgLength ){
      //   console.log('ğŸ˜‘è¯·æ±‚æˆåŠŸå›¾ç‰‡å°‘ä¸æ€»æ•°é‡ï¼Œå‡†å¤‡é‡æ–°æ»šåŠ¨')
      //   startScroll()
      // }else{
      //   console.log('ğŸ±â€ğŸå…¨éƒ¨åŠ è½½æˆåŠŸäº†è€é“ï¼Œå¯ä»¥è¿›è¡Œæˆªå±äº†')
      // }
    }
  </script>

  <script>
    // function print_PerformanceEntries() {
    //   // Use getEntriesByType() to just get the "resource" events
    //   var p = performance.getEntriesByType("resource");

    //   for (var i = 0; i < p.length; i++) {
    //     if (p[i].initiatorType === 'img') {
    //       print_start_and_end_properties(p[i]);
    //     }
    //   }
    // }
    // function print_start_and_end_properties(perfEntry) {
    //   // Print timestamps of the PerformanceEntry *start and *end properties
    //   properties = ["responseStart", "responseEnd"];

    //   for (var i = 0; i < properties.length; i++) {
    //     // check each property
    //     var supported = properties[i] in perfEntry;
    //     if (supported) {
    //       var value = perfEntry[properties[i]];
    //       console.log("... " + properties[i] + " = " + value);
    //     } else {
    //       console.log("... " + properties[i] + " = NOT supported");
    //     }
    //   }
    // }


  </script>

  <script>
    // let nonEmptyImgLength = 0   //éç©ºimgæ€»æ•°åˆå§‹åŒ–
    //
    // function startScroll () {
    //   let y = 0
    //   let step = document.documentElement.clientHeight // å½“å‰è§†çª—çš„é«˜åº¦
    //   window.scroll(0, 0)
    //
    //   function f() {
    //     if (y < document.body.scrollHeight) {
    //       y += step
    //       window.scroll({top: y, left: 0, behavior: 'smooth', onfinish: setFun()})
    //       setTimeout(f, 400)
    //     } else {
    //       console.log(y);
    //       window.scroll({top: 0, left: 0, behavior: 'smooth', onfinish: checkFun()})
    //     }
    //   }
    //   setTimeout(f, 1000)
    // }
    // startScroll()
    //
    // function setFun() {
    //   console.count('æ»šåŠ¨è®¡æ•°');
    // }
    //
    //
    // function checkFun() {
    //   let arr = document.querySelectorAll('img')
    //   let availableImgArr = Array(...arr).filter(n => n.getAttribute('src') !== '')
    //   console.log(availableImgArr)
    //   console.log('æ‰€æœ‰å›¾ç‰‡æ€»æ•°é‡ä¸º', availableImgArr.length)
    //   nonEmptyImgLength = availableImgArr.length
    //   resourceTiming()
    // }
    // function resourceTiming() {
    //   let resourceList = window.performance.getEntriesByType("resource");
    //   let imgResourceList = resourceList.filter(item => item.initiatorType === 'img').length
    //   console.log(resourceList);
    //   console.log('å›¾ç‰‡æ€»æ•°é‡ä¸ºï¼š' + imgResourceList)
    //   let successCount = 0
    //   for (let item of resourceList) {
    //     if (item.initiatorType === "img" && item.nextHopProtocol !== '') {
    //       successCount++;
    //       console.log("è¯·æ±‚æˆåŠŸï¼Œæ—¶é—´ä¸º: " + (item.responseEnd) + 'ã€‚è®¡æ•°ä¸ºï¼š' + successCount);
    //     }
    //     if(item.initiatorType === "img" && item.nextHopProtocol === ''){
    //       console.log('åè®®ä¸ºç©ºçš„itemï¼š',item)
    //     }
    //   }
    //   if(successCount < nonEmptyImgLength ){
    //     console.log('ğŸ˜‘è¯·æ±‚æˆåŠŸå›¾ç‰‡å°‘ä¸æ€»æ•°é‡ï¼Œå‡†å¤‡é‡æ–°æ»šåŠ¨')
    //     startScroll()
    //   }else{
    //     console.log('ğŸ±â€ğŸå…¨éƒ¨åŠ è½½æˆåŠŸäº†è€é“ï¼Œå¯ä»¥è¿›è¡Œæˆªå±äº†')
    //   }
    // }
  </script>
</body>

</html>
